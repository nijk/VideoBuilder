!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),d=r(1),s=i(d),o=r(2),u=i(o),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e);var i=r.fps,n=void 0===i?30:i,d=r.width,s=void 0===d?0:d,o=r.height,u=void 0===o?0:o,h=r.name,c=void 0===h?"download":h;this.window=t,this.movieName=c,this.fps=n,this.width=s,this.height=u,this.reset()}return n(e,[{key:"reset",value:function(){this.avi=null,this.headerLIST=null,this.moviLIST=null,this.frameList=[],this.frameIndices=[],this.indexChunk={},this.movieDesc={fps:this.fps,w:this.width,h:this.height,videoStreamSize:0,maxJPEGSize:0},this.builder=new s.default}},{key:"generate",value:function(e,t){var r=Math.floor(this.builder.settings.RateBase/this.movieDesc.fps);this.avi=this.builder.createAVIStructure(),this.headerLIST=this.builder.createHeaderLIST(),this.moviLIST=this.builder.createMoviLIST(),this.prepareData(e).addFrames().createStreamHeader(r).createAVIHeader(r).createAVIContainer().build(t)}},{key:"build",value:function(e){var t=new u.default;this.builder.appendStructure(t,this.avi);var r=t.getBlob("video/avi");return e?e(r):this.download(r,this.movieName,".avi")}},{key:"download",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r=r.indexOf(".")?r:r.substr(1);var i=r?"."+r:"",a=""+t+i;if(this.window.navigator.msSaveOrOpenBlob)this.window.navigator.msSaveOrOpenBlob(e,a);else{var n=this.window.document.createElement("a");n.href=this.window.URL.createObjectURL(e),n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},{key:"prepareData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.frameList=t.map(function(t){return e.movieDesc.videoStreamSize+=t.size,e.movieDesc.maxJPEGSize<t.size&&(e.movieDesc.maxJPEGSize=t.size),t}),this}},{key:"addFrames",value:function(){this.moviLIST.aStreams=[];for(var e=["chId","dwFlags","dwOffset","dwLength"],t=0,r=this.frameList.length,i=4,a=0;a<r;a++){var n=this.addVideoStreamData(this.moviLIST.aStreams,this.frameList[a]);this.frameIndices.push({chId:"00dc",dwFlags:this.builder.settings.AVIIF_KEYFRAME,dwOffset:i,dwLength:n-8,_order:e}),i+=n,t+=n}return this.moviLIST.dwSize=t+4,this}},{key:"addVideoStreamData",value:function(e,t){var r=this.builder.createMoviStream();return r.dwSize=t.size,r.handler=function(e){return e.append(t)},e.push(r),r.dwSize+8}},{key:"createStreamHeader",value:function(e){var t=this.builder.createStreamHeader();t.wRight=this.movieDesc.w,t.wBottom=this.movieDesc.h,t.dwLength=this.frameList.length,t.dwScale=e;var r=this.builder.createBitmapHeader();r.dwWidth=this.movieDesc.w,r.dwHeight=this.movieDesc.h,r.dwSizeImage=3*r.dwWidth*r.dwHeight;var i=this.builder.createStreamFormat();return i.dwSize=r.dwSize,i.sContent=r,this.streamHeaderLIST=this.builder.createStreamHeaderLIST(),this.streamHeaderLIST.dwSize=4+(t.dwSize+8)+(i.dwSize+8),this.streamHeaderLIST.aList=[t,i],this}},{key:"createAVIHeader",value:function(e){var t=this.builder.createAVIMainHeader();t.dwMicroSecPerFrame=e,t.dwMaxBytesPerSec=this.movieDesc.maxJPEGSize*this.movieDesc.fps,t.dwTotalFrames=this.frameList.length,t.dwWidth=this.movieDesc.w,t.dwHeight=this.movieDesc.h,t.dwSuggestedBufferSize=0;var r=4;return r+=t.dwSize+8,r+=this.streamHeaderLIST.dwSize+8,this.headerLIST.dwSize=r,this.headerLIST.aData=[t,this.streamHeaderLIST],this.indexChunk={chFourCC:"idx1",dwSize:16*this.frameIndices.length,aData:this.frameIndices,_order:["chFourCC","dwSize","aData"]},this}},{key:"createAVIContainer",value:function(){var e=0;return e+=8+this.headerLIST.dwSize,e+=8+this.moviLIST.dwSize,e+=8+this.indexChunk.dwSize,this.avi.dwSize=e+4,this.avi.aData=[this.headerLIST,this.moviLIST,this.indexChunk],this}}]),e}();t.default=h},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e);var r=t||{},a=r.RateBase,n=void 0===a?1e6:a,d=r.AVIF_HASINDEX,s=void 0===d?16:d,o=r.AVIIF_KEYFRAME,u=void 0===o?16:o;this.settings={RateBase:n,AVIF_HASINDEX:s,AVIIF_KEYFRAME:u}}return a(e,[{key:"createAVIStructure",value:function(){return{chRIFF:"RIFF",chFourCC:"AVI ",dwSize:0,aData:null,_order:["chRIFF","dwSize","chFourCC","aData"]}}},{key:"createAVIMainHeader",value:function(){return{chFourCC:"avih",dwSize:56,dwMicroSecPerFrame:66666,dwMaxBytesPerSec:1e3,dwPaddingGranularity:0,dwFlags:this.settings.AVIF_HASINDEX,dwTotalFrames:1,dwInitialFrames:0,dwStreams:1,dwSuggestedBufferSize:0,dwWidth:10,dwHeight:20,dwReserved1:0,dwReserved2:0,dwReserved3:0,dwReserved4:0,_order:["chFourCC","dwSize","dwMicroSecPerFrame","dwMaxBytesPerSec","dwPaddingGranularity","dwFlags","dwTotalFrames","dwInitialFrames","dwStreams","dwSuggestedBufferSize","dwWidth","dwHeight","dwReserved1","dwReserved2","dwReserved3","dwReserved4"]}}},{key:"createHeaderLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"hdrl",aData:null,_order:["chLIST","dwSize","chFourCC","aData"]}}},{key:"createMoviLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"movi",aStreams:null,_order:["chLIST","dwSize","chFourCC","aStreams"]}}},{key:"createMoviStream",value:function(){return{chType:"00dc",dwSize:0,handler:null,_order:["chType","dwSize","handler"]}}},{key:"createStreamHeaderLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"strl",aList:null,_order:["chLIST","dwSize","chFourCC","aList"]}}},{key:"createStreamFormat",value:function(){return{chFourCC:"strf",dwSize:0,sContent:null,_order:["chFourCC","dwSize","sContent"]}}},{key:"createStreamHeader",value:function(){return{chFourCC:"strh",dwSize:56,chTypeFourCC:"vids",chHandlerFourCC:"mjpg",dwFlags:0,wPriority:0,wLanguage:0,dwInitialFrames:0,dwScale:66666,dwRate:this.settings.RateBase,dwStart:0,dwLength:0,dwSuggestedBufferSize:0,dwQuality:1e4,dwSampleSize:0,wLeft:0,wTop:0,wRight:0,wBottom:0,_order:["chFourCC","dwSize","chTypeFourCC","chHandlerFourCC","dwFlags","wPriority","wLanguage","dwInitialFrames","dwScale","dwRate","dwStart","dwLength","dwSuggestedBufferSize","dwQuality","dwSampleSize","wLeft","wTop","wRight","wBottom"]}}},{key:"createBitmapHeader",value:function(){return{dwSize:40,dwWidth:10,dwHeight:20,wPlanes:1,wBitcount:24,chCompression:"MJPG",dwSizeImage:600,dwXPelsPerMeter:0,dwYPelsPerMeter:0,dwClrUsed:0,dwClrImportant:0,_order:["dwSize","dwWidth","dwHeight","wPlanes","wBitcount","chCompression","dwSizeImage","dwXPelsPerMeter","dwYPelsPerMeter","dwClrUsed","dwClrImportant"]}}},{key:"createMJPEG",value:function(){return{W_SOI:65496,aSegments:null,W_EOI:65497,_order:["dwSOI","aSegments","dwEOI"]}}},{key:"appendStructure",value:function(e,t){if(!t._order)throw"Structured data must have '_order'";for(var r=t._order,i=r.length,a=0;a<i;a++){var n=r[a],d=t[n],s=n.charAt(0);switch(s){case"b":var o=new ArrayBuffer(1);new Uint8Array(o)[0]=d,e.append(o);break;case"c":e.append(d);break;case"d":var u=new ArrayBuffer(4),h=new Uint8Array(u);h[0]=255&d,h[1]=d>>8&255,h[2]=d>>16&255,h[3]=d>>24&255,e.append(u);break;case"w":case"W":var c=new ArrayBuffer(2),w=new Uint8Array(c);"w"===s?(w[0]=255&d,w[1]=d>>8&255):(w[0]=d>>8&255,w[1]=255&d),e.append(c);break;case"a":for(var l=d.length,f=0;f<l;f++)this.appendStructure(e,d[f]);break;case"r":e.append(d);break;case"s":this.appendStructure(e,d);break;case"h":d(e);break;default:throw new TypeError("Unknown data type: "+n)}}}}]),e}();t.default=n},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e),this.parts=[]}return a(e,[{key:"append",value:function(e){this.parts.push(e),this.blob=void 0}},{key:"getBlob",value:function(e){return this.blob||(this.blob=new Blob(this.parts,{type:e})),this.blob}}]),e}();t.default=n},function(e,t,r){e.exports=r(0)}])});
//# sourceMappingURL=main.js.map