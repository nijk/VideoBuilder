!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var a in r)("object"==typeof exports?exports:e)[a]=r[a]}}(this,function(){return function(e){function t(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),d=r(1),s=a(d),o=r(2),u=a(o),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var r=t.fps,a=void 0===r?30:r,n=t.width,d=void 0===n?0:n,o=t.height,u=void 0===o?0:o,c={RateBase:void 0,AVIF_HASINDEX:void 0};this.movieDesc={fps:a,w:d,h:u,videoStreamSize:0,maxJPEGSize:0},this.frameList=[],this.frameIndices=[],this.indexChunk={},this.builder=new s.default(c)}return n(e,[{key:"generate",value:function(e,t){var r=Math.floor(this.builder.settings.RateBase/this.movieDesc.fps);console.debug("Generating AVI"),this.avi=this.builder.createAVIStructure(),this.headerLIST=this.builder.createHeaderLIST(),this.moviLIST=this.builder.createMoviLIST(),this.prepareData(e).addFrames().createStreamHeader(r).createAVIHeader(r).createAVIContainer().build(t)}},{key:"build",value:function(e){var t=new u.default;return this.builder.appendStructure(t,this.avi),e(t.getBlob("video/avi"))}},{key:"prepareData",value:function(e){var t=this;return this.frameList=e.map(function(e){return t.movieDesc.videoStreamSize+=e.size,t.movieDesc.maxJPEGSize<e.size&&(t.movieDesc.maxJPEGSize=e.size),e}),this}},{key:"addFrames",value:function(){this.moviLIST.aStreams=[];for(var e=["chId","dwFlags","dwOffset","dwLength"],t=0,r=this.frameList.length,a=4,i=0;i<r;i++){var n=this.addVideoStreamData(this.moviLIST.aStreams,this.frameList[i]);this.frameIndices.push({chId:"00dc",dwFlags:this.builder.settings.AVIIF_KEYFRAME,dwOffset:a,dwLength:n-8,_order:e}),a+=n,t+=n}return this.moviLIST.dwSize=t+4,this}},{key:"addVideoStreamData",value:function(e,t){var r=this.builder.createMoviStream();return r.dwSize=t.size,r.handler=function(e){return e.append(t)},e.push(r),r.dwSize+8}},{key:"createStreamHeader",value:function(e){var t=this.builder.createStreamHeader();t.wRight=this.movieDesc.w,t.wBottom=this.movieDesc.h,t.dwLength=this.frameList.length,t.dwScale=e;var r=this.builder.createBitmapHeader();r.dwWidth=this.movieDesc.w,r.dwHeight=this.movieDesc.h,r.dwSizeImage=3*r.dwWidth*r.dwHeight;var a=this.builder.createStreamFormat();return a.dwSize=r.dwSize,a.sContent=r,this.streamHeaderLIST=this.builder.createStreamHeaderLIST(),this.streamHeaderLIST.dwSize=4+(t.dwSize+8)+(a.dwSize+8),this.streamHeaderLIST.aList=[t,a],this}},{key:"createAVIHeader",value:function(e){var t=this.builder.createAVIMainHeader();t.dwMicroSecPerFrame=e,t.dwMaxBytesPerSec=this.movieDesc.maxJPEGSize*this.movieDesc.fps,t.dwTotalFrames=this.frameList.length,t.dwWidth=this.movieDesc.w,t.dwHeight=this.movieDesc.h,t.dwSuggestedBufferSize=0;var r=4;return r+=t.dwSize+8,r+=this.streamHeaderLIST.dwSize+8,this.headerLIST.dwSize=r,this.headerLIST.aData=[t,this.streamHeaderLIST],this.indexChunk={chFourCC:"idx1",dwSize:16*this.frameIndices.length,aData:this.frameIndices,_order:["chFourCC","dwSize","aData"]},this}},{key:"createAVIContainer",value:function(){var e=0;return e+=8+this.headerLIST.dwSize,e+=8+this.moviLIST.dwSize,e+=8+this.indexChunk.dwSize,this.avi.dwSize=e+4,this.avi.aData=[this.headerLIST,this.moviLIST,this.indexChunk],this}}]),e}();t.default=c},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t){a(this,e);var r=t||{},i=r.RateBase,n=void 0===i?1e6:i,d=r.AVIF_HASINDEX,s=void 0===d?16:d,o=r.AVIIF_KEYFRAME,u=void 0===o?16:o;this.settings={RateBase:n,AVIF_HASINDEX:s,AVIIF_KEYFRAME:u}}return i(e,[{key:"createAVIStructure",value:function(){return{chRIFF:"RIFF",chFourCC:"AVI ",dwSize:0,aData:null,_order:["chRIFF","dwSize","chFourCC","aData"]}}},{key:"createAVIMainHeader",value:function(){return{chFourCC:"avih",dwSize:56,dwMicroSecPerFrame:66666,dwMaxBytesPerSec:1e3,dwPaddingGranularity:0,dwFlags:this.settings.AVIF_HASINDEX,dwTotalFrames:1,dwInitialFrames:0,dwStreams:1,dwSuggestedBufferSize:0,dwWidth:10,dwHeight:20,dwReserved1:0,dwReserved2:0,dwReserved3:0,dwReserved4:0,_order:["chFourCC","dwSize","dwMicroSecPerFrame","dwMaxBytesPerSec","dwPaddingGranularity","dwFlags","dwTotalFrames","dwInitialFrames","dwStreams","dwSuggestedBufferSize","dwWidth","dwHeight","dwReserved1","dwReserved2","dwReserved3","dwReserved4"]}}},{key:"createHeaderLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"hdrl",aData:null,_order:["chLIST","dwSize","chFourCC","aData"]}}},{key:"createMoviLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"movi",aStreams:null,_order:["chLIST","dwSize","chFourCC","aStreams"]}}},{key:"createMoviStream",value:function(){return{chType:"00dc",dwSize:0,handler:null,_order:["chType","dwSize","handler"]}}},{key:"createStreamHeaderLIST",value:function(){return{chLIST:"LIST",dwSize:0,chFourCC:"strl",aList:null,_order:["chLIST","dwSize","chFourCC","aList"]}}},{key:"createStreamFormat",value:function(){return{chFourCC:"strf",dwSize:0,sContent:null,_order:["chFourCC","dwSize","sContent"]}}},{key:"createStreamHeader",value:function(){return{chFourCC:"strh",dwSize:56,chTypeFourCC:"vids",chHandlerFourCC:"mjpg",dwFlags:0,wPriority:0,wLanguage:0,dwInitialFrames:0,dwScale:66666,dwRate:this.settings.RateBase,dwStart:0,dwLength:0,dwSuggestedBufferSize:0,dwQuality:1e4,dwSampleSize:0,wLeft:0,wTop:0,wRight:0,wBottom:0,_order:["chFourCC","dwSize","chTypeFourCC","chHandlerFourCC","dwFlags","wPriority","wLanguage","dwInitialFrames","dwScale","dwRate","dwStart","dwLength","dwSuggestedBufferSize","dwQuality","dwSampleSize","wLeft","wTop","wRight","wBottom"]}}},{key:"createBitmapHeader",value:function(){return{dwSize:40,dwWidth:10,dwHeight:20,wPlanes:1,wBitcount:24,chCompression:"MJPG",dwSizeImage:600,dwXPelsPerMeter:0,dwYPelsPerMeter:0,dwClrUsed:0,dwClrImportant:0,_order:["dwSize","dwWidth","dwHeight","wPlanes","wBitcount","chCompression","dwSizeImage","dwXPelsPerMeter","dwYPelsPerMeter","dwClrUsed","dwClrImportant"]}}},{key:"createMJPEG",value:function(){return{W_SOI:65496,aSegments:null,W_EOI:65497,_order:["dwSOI","aSegments","dwEOI"]}}},{key:"appendStructure",value:function(e,t){if(!t._order)throw"Structured data must have '_order'";for(var r=t._order,a=r.length,i=0;i<a;i++){var n=r[i],d=t[n],s=n.charAt(0);switch(s){case"b":var o=new ArrayBuffer(1);new Uint8Array(o)[0]=d,e.append(o);break;case"c":e.append(d);break;case"d":var u=new ArrayBuffer(4),c=new Uint8Array(u);c[0]=255&d,c[1]=d>>8&255,c[2]=d>>16&255,c[3]=d>>24&255,e.append(u);break;case"w":case"W":var h=new ArrayBuffer(2),w=new Uint8Array(h);"w"===s?(w[0]=255&d,w[1]=d>>8&255):(w[0]=d>>8&255,w[1]=255&d),e.append(h);break;case"a":for(var l=d.length,f=0;f<l;f++)this.appendStructure(e,d[f]);break;case"r":e.append(d);break;case"s":this.appendStructure(e,d);break;case"h":d(e);break;default:throw new TypeError("Unknown data type: "+n)}}}}]),e}();t.default=n},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(){a(this,e),this.parts=[]}return i(e,[{key:"append",value:function(e){this.parts.push(e),this.blob=void 0}},{key:"getBlob",value:function(e){return this.blob||(this.blob=new Blob(this.parts,{type:e})),this.blob}}]),e}();t.default=n},function(e,t,r){e.exports=r(0)}])});
//# sourceMappingURL=main.js.map